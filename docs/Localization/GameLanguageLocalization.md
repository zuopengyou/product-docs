# 游戏语言本地化

**阅读本文大约需要10分钟**

本文讲述了本地化的含义、使用方法与流程。

# 1.什么是本地化

本地化是指让编辑器制作的游戏能够显示不同的语种，此处的条件由开发者自行控制（可以根据不同windows语言自动显示对应语种，也可以做到UI中让玩家手动切换语言，可以实现开发者想要的逻辑）

# 2.本地化功能的使用

##  功能入口：工具栏——游戏本地化

![](https://cdn.233xyx.com/1683772791550_548.png)

![](https://cdn.233xyx.com/1683772792253_003.png)

## 收集文本：左上角收集文本按钮
  
  ### 两种收集方式：覆盖与新增
    * 覆盖：收集当前编辑器中的所有原文本并覆盖
    * 新增：收集当前编辑器中的所有原文本，新增当前表格中没有的原文本
      
      ![](https://cdn.233xyx.com/1683772791455_518.png)
  ### key的意义：UI组件中的原始文本或者代码中的原始文本
  * 怎么让key被收集到：
    * 方法一：勾选UI组件的本地化字段
      
      ![](https://cdn.233xyx.com/1683772792297_668.png)
    * 方法二：在ts脚本中使用Util.LanguageUtil.locText("Key")标记文本
 
    * 备注：1、该函数返回key本身，一般用于标识代码中出现的新文本；
       2、必须使用双引号标记key的字符串，使用单引号会导致该文本无法被收集到
     
        ![](https://cdn.233xyx.com/athena/online/0a054894090e4952bd828e15eae571ce_14768802.webp)

        ![](https://cdn.233xyx.com/athena/online/b1f34bf63f6c4b96bedab980d2a9750d_14768803.webp)

## 支持语言：
  
  ![](https://cdn.233xyx.com/1683772791504_999.png)
  
  * 选择一种语言后，下方文本配置表显示对应语言的配置表
  * 暂时只支持中、英、葡萄牙语
## 自动翻译：将所有当前所选支持语言下**未配置**的文本进行自动翻译
  
  ![](https://cdn.233xyx.com/1683772791594_176.png)
  
  * 备注：自动翻译有时候无法翻译全部文本，需要自行配置未翻译的文本
## 配置表：
  
  * 左侧显示key，右侧显示配置信息
  * 收集文本成功后自动填入，不可编辑，悬浮至文本框上时可通过tips查看全部信息
    
    ![](https://cdn.233xyx.com/1683772791770_869.png)
  * 右侧为key的翻译，若key在某一语言环境下未被翻译，则在该语言环境下显示key本身
## 搜索功能：支持对当前支持语言下的**key与配置文本**进行模糊搜索
  
  ![](https://cdn.233xyx.com/1683772791725_354.png)
  
  * 搜索结果不会实时更新，需区别于编辑器通用的搜索框（此设计为了防止在搜索状态下配置时，修改配置导致此条目被移出当前的搜索结果）
  * 若要更新搜索结果，可重新输入关键词，或者聚焦至搜索框时回车，或者点击搜索图标
## 筛选功能：支持对“是否配置”这一条件进行筛选
  
  ![](https://cdn.233xyx.com/1683772791450_708.png)
  
  * 筛选结果同样不会实时更新，目的与搜索一致
  * 若要更新筛选结果，更改任意筛选项时即可更新
## 页码逻辑：
  
  ![](https://cdn.233xyx.com/1683772791639_478.png)
  
  * 点击向前/向后按钮，页码向前/向后加一
  * 点击页码，跳转至该页码
  * 页码输入框：输入参数，点击空白处生效，并清空输入
    * 只允许输入数字
    * 若输入数字超过当前页码范围，点击空白处时则不生效，并清空输入
* 若当前转换文本下存在XX条未翻译的文本，弹窗左下角显示“剩余XX条待配置的信息”
  
  ![](https://cdn.233xyx.com/1683772791684_311.png)
* 若当前转换文本下所有key值均被翻译，表格显示“当前语言已全部配置”
  
  ![](https://cdn.233xyx.com/1683772791493_846.png)
## 配置表的导出
  
  * 导出为Excel表，表头格式如下·，每一个语言对应编辑器中的一种支持语言
    
| key | Chinese | English | Portuguese |
| ----- | --------- | --------- | ------------ |
    
    
  * 导出文件格式为XLSX
  * 导出文件默认名称为“项目名+Translate”
  * 支持从外部导入表格，文件格式支持XLSX
## 配置表的导入
  
  * 导入的两种方式
    
    * 覆盖：将当前表格中的所有文本以及配置全部覆盖
    * 新增：新增当前表格中没有的原文本与配置
      
      ![](https://cdn.233xyx.com/1683772792209_565.png)
  * 导入后校验格式
    
    * 若表头字段均为当前支持字段，导入成功
    * 若表头字段包含当前不支持的字段，导入失败
  * 自动忽略key为空的行
  * 若存在相同的多个key，行数最大的key将会生效，行数小的将被忽略
  * eg：将下表导入后语言配置表显示如图
    
    ![](https://cdn.233xyx.com/1683772791904_410.png)
  
  ![](https://cdn.233xyx.com/1683772792339_174.png)![](https://cdn.233xyx.com/1683772792079_698.png)![](https://cdn.233xyx.com/1683772792123_564.png)
## 应用、取消按钮
  
  * 点击应用按钮，将配置信息保存至工程
  * 点击取消按钮，将校验有无未保存的配置项，如果没有则退出，如果有则弹出弹窗提示
    
    ![](https://cdn.233xyx.com/1683772792035_018.png)
    
    * 点击确认按钮，关闭本地化页面，并清空未保存的所有配置项
    * 点击取消按钮，取消该操作
## 预览语言能力
  
  * 在完成表格的配置后，可以对主编辑器中显示的UI或UI编辑器中的UI文件按配置表中某一语言配置进行显示
  * 预览的语言类型可以是原文本、中文、英文、葡萄牙文
  * 仅在编辑态下生效，运行时不生效（运行时需进行语言设置）
  * 主编辑器预览语言切换：
    * 备注：世界UI的预览目前还无法在主视口下正常进行本地化预览，pie中可以正常预览
  
      ![](https://cdn.233xyx.com/1683772792167_079.png)
  
  * UI编辑器预览语言切换：
    
    ![](https://cdn.233xyx.com/1683772792383_951.png)
## 语言设置
  
  * 提供API设置语言
  
| API名称                                                             | 参数说明                                            | 返回                            | 注释                |
| --------------------------------------------------------------------- | ----------------------------------------------------- | --------------------------------- | --------------------- |
| Util.LanguageUtil.useLocalizedLanguage（Type：LanguageType）：void | LanguageType存在Chinese、English、Portuguese三个值 | callback：isSuccessed：boolean | 设置游戏使用的语言 |
    
    
* **Util.LanguageUtil.getLocTextValue(“key”)函数**
  
  * 除上述设置语言的函数Util.LanguageUtil.useLocalizedLanguage与标记本地化的函数Util.LanguageUtil.locText("Key")之外；我们还提供了Util.LanguageUtil.getLocTextValue(“key”)函数，该函数的作用是： **返回该key在此语言环境下的value** ；
  * 一般来说，对于静态设置且不涉及到拼接的文本来说，无需用到getLocTextValue函数，直接UI组件.text=Util.LanguageUtil.locText("key")就可以使此UI组件的文本属性本地化，对应的配置为key的多语言配置；
    但如果涉及到字符串**拼接或动态拼接**时，仅用Util.LanguageUtil.locText("key")函数是无法实现的，需要用Util.LanguageUtil.getLocTextValue(“key”)函数进行拼接

# 3.简单示例1：点击按钮，切换中文文本为英文

* 第一步：完成UI并保存，打开本地化界面，点击收集文本

![](https://cdn.233xyx.com/1683772791950_465.png)![](https://cdn.233xyx.com/1683772791816_667.png)

* 第二步：将支持语言切换至英文，对需要本地化的文本进行配置，并点击应用

![](https://cdn.233xyx.com/1683772791991_416.png)

* 第三步：编写如下代码

![](https://cdn.233xyx.com/1683772791860_799.png)

*  最终运行效果如下：

<video controls src="https://cdn.233xyx.com/athena/online/3d673c15698e450fb72751f498cd14c7.mp4"></video>

# 4.简单示例2：动态文本拼接

* locText不支持文本动态拼接

![](https://cdn.233xyx.com/athena/online/211ba8241cb14f319cee2b86c1a1f66a_14768798.webp)

![](https://cdn.233xyx.com/athena/online/938eaa64008a44d4a6d741f80cd4d122_14768799.webp)

* 此时需要使用getLocTextValue返回对应key已配置好的文本

![](https://cdn.233xyx.com/athena/online/0ed1088bef804f079985d98f04987b69_14768800.webp)

![](https://cdn.233xyx.com/athena/online/357da4a1edee49ee817d0dddb9c3367a_14768801.webp)


